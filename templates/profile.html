{% extends "base.html" %}

{% block title %}–ü—Ä–æ—Ñ–∏–ª—å - {{ user.name }}{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='profile.css') }}">
{% endblock %}

{% block content %}
<div class="profile-container">
    <div class="profile-header">
        <div class="user-info">
            <div class="avatar">{{ user.name[0].upper() }}</div>
            <div class="user-details">
                <h1>{{ user.name }}</h1>
                <p class="email">{{ user.email }}</p>
                <p class="member-since">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω: {{ user.created_date.strftime('%d.%m.%Y') }}</p>
            </div>
        </div>

        {% if is_own_profile or current_user.admin %}
        <div class="profile-actions">
            <a class="btn btn-primary" href="/edit/profile/{{ user.id }}">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</a>
        </div>
        {% endif %}

        <div class="stats-cards">
            <div class="stat-card">
                <div class="stat-value">{{ user.elo_rating|round|int }}</div>
                <div class="stat-label">–†–µ–π—Ç–∏–Ω–≥ ELO</div>
            </div>

            <div class="stat-card">
                <div class="stat-value">{{ solved_tasks }}</div>
                <div class="stat-label">–†–µ—à–µ–Ω–æ –∑–∞–¥–∞—á</div>
            </div>

            <div class="stat-card">
                <div class="stat-value">{{ total_tasks_attempted }}</div>
                <div class="stat-label">–ü–æ–ø—ã—Ç–æ–∫ –∑–∞–¥–∞—á</div>
            </div>

            <div class="stat-card">
                <div class="stat-value">{{ total_submissions }}</div>
                <div class="stat-label">–í—Å–µ–≥–æ –ø–æ–ø—ã—Ç–æ–∫</div>
            </div>
        </div>
    </div>

    <div class="profile-content">
        {% if tasks_stats %}
        <div class="tasks-list">
            {% for task_stat in tasks_stats %}
            <div class="task-item {% if task_stat.solved %}solved{% endif %}">
                <div class="task-header">
                    <div class="task-title-section">
                        <span class="status-badge {% if task_stat.solved %}badge-success{% else %}badge-partial{% endif %}">
                            {% if task_stat.solved %}
                                ‚úì –†–µ—à–µ–Ω–æ
                            {% else %}
                                –ß–∞—Å—Ç–∏—á–Ω–æ
                            {% endif %}
                        </span>
                        <h3>
                            <a href="/{{ subject }}/task/{{ task_stat.task.id }}">{{ task_stat.task.title }}</a>
                        </h3>
                    </div>
                    <div class="task-meta">
                        <span class="difficulty difficulty-{{ task_stat.task.difficulty|lower }}">
                            {{ task_stat.task.difficulty }}
                        </span>
                        <span class="task-subject">{{ task_stat.subject|capitalize }}</span>
                    </div>
                </div>

                <div class="task-stats">
                    <div class="stat-item">
                        <span class="stat-icon">üìù</span>
                        <span>–ü–æ–ø—ã—Ç–æ–∫: {{ task_stat.attempts }}</span>
                    </div>
                    {% if task_stat.best_submission.total_tests != None %}
                    <div class="stat-item">
                        <span class="stat-icon">‚úì</span>
                        <span>–¢–µ—Å—Ç–æ–≤: {{ task_stat.best_submission.total_tests }}/5</span>
                    </div>
                    {% endif %}
                    <div class="stat-item">
                        <span class="stat-icon">üèÜ</span>
                        <span>–í–µ—Ä–¥–∏–∫—Ç: {{ task_stat.best_submission.verdict }}</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-icon">üìÖ</span>
                        <span>{{ task_stat.best_submission.created_at.strftime('%d.%m.%Y %H:%M') }}</span>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="no-tasks">
            <p>{% if is_own_profile %}–í—ã –µ—â–µ –Ω–µ —Ä–µ—à–∞–ª–∏ –∑–∞–¥–∞—á–∏{% else %}–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –µ—â–µ –Ω–µ —Ä–µ—à–∞–ª –∑–∞–¥–∞—á–∏{% endif %}</p>
            {% if is_own_profile %}
            <a href="/{{ subject }}" class="btn btn-primary">–ü–µ—Ä–µ–π—Ç–∏ –∫ –∑–∞–¥–∞—á–∞–º</a>
            {% endif %}
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
